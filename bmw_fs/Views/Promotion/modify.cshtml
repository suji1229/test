@{
    ViewBag.Title = "웹 프로모션 수정";
}
<!doctype html>
<head>
<style>
.reg .cont_bottom .reg_table td.file_area p{float:none; clear:both; padding-top:10px}
.reg .cont_bottom .reg_table td.file_area p input[type="text"]{width:467px}
.reg h4{margin-bottom:10px}

.file_area{counter-reset:cnt1; }
.file_src.on:after{content:""; color:#666;}
.thum_nail:after{content:"사이즈 307 * 233"; display:inline-block; padding: 7px 0 0 5px}
.top_main_text:after{content:"사이즈 950 * 258 "; display:inline-block; padding: 7px 0 0 5px}
</style>
</head>
		<div id="content" class="reg">
			<div class="cont_top">
				<h3>웹 프로모션</h3>
			</div>
			<div class="cont_bottom">
                <form method="post" enctype="multipart/form-data">
                    <table class="reg_table">
                        <colgroup>
                            <col width="130px" />
                            <col width="*" />
                        </colgroup>
                        <tr>
                            <th>작성자</th>
                            <td>@ViewBag.item.regId</td>
                        </tr>
                        <tr>
                            <th><label for="startDate">게시 기간</label></th>
                            <td><input type="date" id="startDate" name="startDate" value="@ViewBag.item.startDate" title="게시 시작일"> ~ <input type="date" id="endDate" name="endDate" value="@ViewBag.item.endDate" title="게시 종료일"></td>
                        </tr>
                        <tr>
                            <th>영문 사이트</th>
                            <td class="radio_area">
                                <label for="engY"><input type="radio" name="engYn" id="engY" value="Y"> 있음</label>
                                <label for="engN"><input type="radio" name="engYn" id="engN" value="N" checked> 없음</label>
                            </td>
                        </tr>
                        <tr>
                            <th><label for="">배포</label></th>
                            <td class="radio_area">
                                <label for="deployY"><input type="radio" name="deployYn" id="deployY" value="Y"> 배포</label>
                                <label for="deployN"><input type="radio" name="deployYn" id="deployN" value="N"> 미배포</label>
                            </td>
                        </tr>
                    </table>
                    <h4>국문사이트</h4>
                    <table class="reg_table">
                        <colgroup>
                            <col width="130px" />
                            <col width="*" />
                        </colgroup>
                        <tr>
                            <th><label for="tit">제목</label></th>
                            <td><input type="text" class="tit" name="title" id="tit" value="@ViewBag.item.title" title="국문 제목"></td>
                        </tr>
                        <tr class="add_img_area">
                            <th>썸네일 이미지</th>
                            <td class="file_area">
                                 @if (ViewBag.thumbList.Count != 0)
                                 {
                                     for (int i = 0, size = ViewBag.thumbList.Count; i < size; i++)
                                     {
                                        <div class="thum_nail">
                                            <span class="file_src">@ViewBag.thumbList[i].originalFilename</span>
                                            <input type="file" class="input_file" name="thumbNail" id="thumbNail">
                                            <label for="thumbNail" class="btn_file">파일찾기</label>
                                            <input type="hidden" name="thumbIdxs" value="@ViewBag.thumbList[i].fileIdx" />
                                        </div>
                                     }
                                 }
                                 else
                                 {
                                    <div class="thum_nail">
                                        <span class="file_src"></span>
                                        <input type="file" class="input_file" name="thumbNail" id="thumbNail">
                                        <label for="thumbNail" class="btn_file">파일찾기</label>
                                    </div>
                                 }
                            </td>
                        </tr>
                        <tr class="add_img_area">
                            <th>본문 상단 이미지</th>
                            <td class="file_area">
                                 @if (ViewBag.topMainList.Count != 0)
                                 {
                                     for (int i = 0, size = ViewBag.topMainList.Count; i < size; i++)
                                     {
                                        <div class="top_main_text">
                                            <span class="file_src">@ViewBag.topMainList[i].originalFilename</span>
                                            <input type="file" class="input_file" name="topMain" id="topMainText">
                                            <label for="topMainText" class="btn_file">파일찾기</label>
                                            <input type="hidden" name="fileIdxs" value="@ViewBag.topMainList[i].fileIdx" />
                                        </div>
                                     }
                                 }
                                 else
                                 {
                                    <div class="top_main_text">
                                        <span class="file_src"></span>
                                        <input type="file" class="input_file" name="topMain" id="topMainText">
                                        <label for="topMainText" class="btn_file">파일찾기</label>
                                    </div>
                                 }
                            </td>
                        </tr>
                        <tr class="add_img_area kor">
                            <th>본문 이미지</th>
                            <td class="file_area">
                                 @if (ViewBag.mainImgList.Count != 0)
                                 {
                                     for (int i = 0, size = ViewBag.mainImgList.Count; i < size; i++)
                                     {
                                        <div class="file_item">
                                            <span class="file_src">@ViewBag.mainImgList[i].originalFilename</span>
                                            <input type="file" class="input_file" name="mainImg" id="file@(i)">
                                            <label for="file@(i)" class="btn_file">파일찾기</label>
                                            @if(i == 0){
                                                <button type="button" class="btn_add_file" id="btnAddFile">첨부파일 추가</button>
                                            }
                                            else
                                            {
                                                <button type="button" class="btnDelete" data-key="@ViewBag.mainImgList[i].fileIdx" onclick="deleteFile(this);">첨부파일 삭제</button>
                                            }
                                            <p><label for="url@(i)"><input type="text" name="mainImgLinks" id="url@(i)" placeholder="이미지에 대한 링크 URL" value="@ViewBag.imgUrlList[i]"></label></p>
                                            <input type="hidden" name="mainIdxs" value="@ViewBag.mainImgList[i].fileIdx" />
                                        </div>
                                     }
                                 }
                                 else
                                 {
                                    <div>
                                        <span class="file_src"></span>
                                        <input type="file" class="input_file" name="mainImg" id="file0">
                                        <label for="file0" class="btn_file">파일찾기</label>
                                        <button type="button" class="btn_add_file" id="btnAddFile">첨부파일 추가</button>
                                        <p><label for="url0"><input type="text" name="mainImgLinks" id="url0" placeholder="이미지에 대한 링크 URL"></label></p>
                                    </div>
                                 }
                            </td>
                        </tr>
                        <tr>
                            <th rowspan="2"><label for="">상품 페이지 배너</label></th>
                            <td class="radio_area">
                                <label for="productBannerY"><input type="radio" name="productBannerYn" id="productBannerY" value="Y"> 배포</label>
                                <label for="productBannerN"><input type="radio" name="productBannerYn" id="productBannerN" value="N"> 미배포</label>
                            </td>
                        </tr>
                        <tr>
                            <td class="checkbox_area">
                                <label for="productType1"><input type="checkbox" class="productTypeKor" id="productType1" name="productType1" value="Y"> 잔가보장형 상품</label>
                                <label for="productType2"><input type="checkbox" class="productTypeKor" id="productType2" name="productType2" value="Y"> 일반 할부 상품</label>
                            </td>
                        </tr>
                    </table>
                    <h4 class="eng_site" style="display:none;">영문사이트</h4>
                    <table class="reg_table eng_site" style="display:none;">
                        <colgroup>
                            <col width="130px" />
                            <col width="*" />
                        </colgroup>
                        <tr>
                            <th><label for="tit">제목</label></th>
                            <td><input type="text" class="tit" id="titEng" name="titleEng" value="@ViewBag.item.titleEng" title="영문 제목"></td>
                        </tr>
                        <tr class="add_img_area">
                            <th>썸네일 이미지</th>
                            <td class="file_area">
                            @if (ViewBag.thumbEngList.Count != 0)
                            {
                                for (int i = 0, size = ViewBag.thumbEngList.Count; i < size; i++)
                                {
                                    <div class="thum_nail">
                                        <span class="file_src">@ViewBag.thumbEngList[i].originalFilename</span>
                                        <input type="file" class="input_file" name="engThumbNail" id="engThumbNail">
                                        <label for="engThumbNail" class="btn_file">파일찾기</label>
                                        <input type="hidden" name="engThumbIdxs" value="@ViewBag.thumbEngList[i].fileIdx" />
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="thum_nail">
                                    <span class="file_src"></span>
                                    <input type="file" class="input_file" name="engThumbNail" id="engThumbNail">
                                    <label for="engThumbNail" class="btn_file">파일찾기</label>
                                </div>
                            }
                            </td>
                        </tr>
                        <tr class="add_img_area">
                            <th>본문 상단 이미지</th>
                            <td class="file_area">
                                @if (ViewBag.topMainEngList.Count != 0)
                                {
                                     for (int i = 0, size = ViewBag.topMainEngList.Count; i < size; i++)
                                        {
                                        <div class="top_main_text">
                                            <span class="file_src">@ViewBag.topMainEngList[i].originalFilename</span>
                                            <input type="file" class="input_file" name="engTopMain" id="engTopMainText">
                                            <label for="engTopMainText" class="btn_file">파일찾기</label>
                                            <input type="hidden" name="engFileIdxs" value="@ViewBag.topMainEngList[i].fileIdx" />
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="top_main_text">
                                        <span class="file_src"></span>
                                        <input type="file" class="input_file" name="engTopMain" id="engTopMainText">
                                        <label for="engTopMainText" class="btn_file">파일찾기</label>
                                    </div>
                                }
                            </td>
                        </tr>
                        <tr class="add_img_area eng">
                            <th>본문 이미지</th>
                            <td class="file_area">
                                 @if (ViewBag.mainImgEngList.Count != 0)
                                 {
                                     for (int i = 0, size = ViewBag.mainImgEngList.Count; i < size; i++)
                                     {
                                        <div class="file_item">
                                            <span class="file_src"> @ViewBag.mainImgEngList[i].originalFilename</span>
                                            <input type="file" class="input_file" name="engMainImg" id="engfile@(i)">
                                            <label for="engfile@(i)" class="btn_file">파일찾기</label>
                                            @if(i == 0){
                                                <button type="button" class="btn_add_file" id="btnAddFile">첨부파일 추가</button>
                                            }
                                            else
                                            {
                                                <button type="button" class="btnDelete" data-key="@ViewBag.mainImgEngList[i].fileIdx" onclick="deleteFile(this);">첨부파일 삭제</button>
                                            }
                                            <p><label for="engurl@(i)"><input type="text" name="mainImgEngLinks" id="engurl@(i)" placeholder="이미지에 대한 링크 URL" value="@ViewBag.imgUrlEngList[i]"></label></p>
                                            <input type="hidden" name="engMainIdxs" value="@ViewBag.mainImgEngList[i].fileIdx" />
                                        </div>
                                     }
                                 }
                                 else
                                 {
                                    <div>
                                        <span class="file_src"></span>
                                        <input type="file" class="input_file" name="engMainImg" id="engfile0">
                                        <label for="engfile0" class="btn_file">파일찾기</label>
                                        <button type="button" class="btn_add_file" id="btnAddFile">첨부파일 추가</button>
                                        <p><label for="engurl0"><input type="text" name="mainImgEngLinks" id="engurl0" placeholder="이미지에 대한 링크 URL"></label></p>
                                    </div>
                                 }
                            </td>
                        </tr>
                        <tr>
                            <th rowspan="2"><label for="">상품 페이지 배너</label></th>
                            <td class="radio_area">
                                <label for="productBannerEngY"><input type="radio" name="productBannerYnEng" id="productBannerEngY" value="Y"> 배포</label>
                                <label for="productBannerEngN"><input type="radio" name="productBannerYnEng" id="productBannerEngN" value="N"> 미배포</label>
                            </td>
                        </tr>
                        <tr>
                            <td class="checkbox_area">
                                <label for="productType1Eng"><input type="checkbox" class="productTypeEng" name="productType1Eng" id="productType1Eng" value="Y"> 잔가보장형 상품</label>
                                <label for="productType2Eng"><input type="checkbox" class="productTypeEng" name="productType2Eng" id="productType2Eng" value="Y"> 일반 할부 상품</label>
                            </td>
                        </tr>
                    </table>
                    <input type="hidden" name="idx" value="@ViewBag.item.idx"/>
                    </form>
                    <div class="btn_area">
                        <a href="list" class="btn_defualt btn_list">목록</a>
                        <a href="javascript:void(0);" class="btn_defualt btn_reg" onclick="modForm();">수정</a>
                    </div>
</div>
		</div>
<script>
    lnbSet(2, 1);
    //value setting (kor)
    if('@ViewBag.item.engYn' === 'Y'){
     $('#engY').prop('checked', true);
    }else{
     $('#engN').prop('checked', true);
    }
    if('@ViewBag.item.deployYn' === 'Y'){
        $('#deployY').prop('checked', true);
    }else{
        $('#deployN').prop('checked', true);
    }
   if('@ViewBag.item.productBannerYn' === 'Y'){
       $('#productBannerY').prop('checked', true);
    }else{
       $('#productBannerN').prop('checked', true);
    }
    if ('@ViewBag.item.productBannerYn' === 'Y') {
        if ('@ViewBag.item.productType1' === 'Y') {
            $('#productType1').prop('checked', true);
        }
        if ('@ViewBag.item.productType2' === 'Y') {
            $('#productType2').prop('checked', true);
        }
    } else {
        $('#productType1').prop('checked', true);
        $('.productTypeKor').prop('disabled', true);//상품 배너(국문) 체크박스
    }
    //value setting (eng)
    if ('@ViewBag.item.engYn' === 'Y') {
        $('.eng_site').show();
        if('@ViewBag.item.productBannerYn' === 'Y'){
            $('#productBannerEngY').prop('checked', true);
        }else{
            $('#productBannerEngN').prop('checked', true);
        }
        if ('@ViewBag.item.productBannerYnEng' === 'Y') {
            if ('@ViewBag.item.productType1Eng' === 'Y') {
                $('#productType1Eng').prop('checked', true);
            }
            if ('@ViewBag.item.productType2Eng' === 'Y') {
                $('#productType2Eng').prop('checked', true);
            }
        }
    } else {
        $('#productType1Eng').prop('checked', true);
        $('.productTypeEng').prop('disabled', true);//상품 배너(영문) 체크박스
    }

    function modForm() {
        //if (!validation()) return;
        if (!confirm('수정하시겠습니까?')) return;
        $('#content form').attr('action', 'modifyProc').submit();
    };

    function validation() {
        var mainImgFlagKor = false;
        var mainImgFlagEng = false;

        if (!$('#startDate').required()) return;
        if (!$('#endDate').required()) return;
        if (!$('#tit').required()) return;
        if ($('#thumbNail').val() === '') {
            alert('국문 썸네일을 등록하세요.');
            return;
        }
        if ($('#topMainText').val() === '') {
            alert('국문 본문 상단 이미지를 등록하세요.');
            return;
        }
        $('input[name=mainImg]').each(function () {
            if ($(this).val() === '') {
                mainImgFlagKor = true;
            }
        });
        if (mainImgFlagKor) {
            alert('국문 본문 이미지를 등록하세요.');
            return;
        }
        //if ($('#productBannerY').prop('checked')) {
        //    if ($('.productType:checked').length == 0) {
        //        alert('상품 페이지 배너 종류를 선택하세요. (국문)');
        //        return;
        //    }
        //}

        if ($('#engY').prop('checked')) {
            if (!$('#titEng').required()) return;
            if ($('#engThumbNail').val() === '') {
                alert('영문 썸네일을 등록하세요.');
                return;
            }
            if ($('#engTopMainText').val() === '') {
                alert('영문 본문 상단 이미지를 등록하세요.');
                return;
            }
            $('input[name=engMainImg]').each(function () {
                if ($(this).val() === '') {
                    mainImgFlagEng = true;
                }
            });
            if (mainImgFlagEng) {
                alert('영문 본문 이미지를 등록하세요.');
                return;
            }
            //if ($('#productBannerEngY').prop('checked')) {
            //    if ($('.productTypeEng:checked').length == 0) {
            //        alert('상품 페이지 배너 종류를 선택하세요. (영문)');
            //        return;
            //    }
            //}
        }
        return true;
    };

    function deleteFile(obj) {
        //실제 파일 삭제 
        if (!confirm('파일을 삭제하시겠습니까?')) return;
        $obj = $(obj);
        $fileKey = $obj.attr('data-key');
        if (!$fileKey == '') {
            $.ajax({
                url: '/Files/fileDelete',
                data: { 'key': $fileKey },
                dataType: 'json',
                timeout: 10000,
                cache: false,
                type: 'POST',
                beforeSend: function () {
                    //$.blockUI(_BLOCKUI_OPTION);
                },
                complete: function () {
                    //$.unblockUI();
                },
                error: function (x, e) {
                    alert('요청하신 작업을 수행하던 중 예상치 않게 중지되었습니다.\n\n다시 시도해 주십시오.');
                },
                success: function (data) {
                    if (!data) {
                        alert('파일이 존재하지 않습니다.');
                        return;
                    }
                    return;
                }
            });
        }
        $obj.parent("div").remove();

    };

(function($){
	var $fileArea = $(".add_img_area").find('.file_area');

	$(".add_img_area").find(".file_area").on("change",".input_file",function(e){
		var $parent = $(this).closest("div");
		var val = $(this).val();
		var valTit = val.split("\\");
		var valTittext = valTit[valTit.length -1]
		if(val != ""){
			$parent.find(".file_src").text(valTittext).addClass("on");
		};
	});

	$(".add_img_area").each(function(index, item){
		//var cnt = 0;
        var cnt = $(item).find(".file_item").length;
        $(item).find(".btn_add_file").on("click", function () {
			if($(item).find( "input[type='file']" ).length < 20){
				cnt++;
				if($(item).is(".kor")){
                    var html = '<div><span class="file_src"></span><input type="file" class="input_file" id="file' + cnt + '" name="mainImg" /><label for="file' + cnt + '" class="btn_file">파일찾기</label><button type="button" class="btnDelete" data-key="" onclick="deleteFile(this);">첨부파일 삭제</button><p><label for="url' + cnt +'"><input type="text" name="mainImgLinks" id="url'+ cnt +'"placeholder="이미지에 대한 링크 URL"></label></p></div>';
					console.log("kor", cnt);
				}
				if($(item).is(".eng")){
                    var html = '<div><span class="file_src"></span><input type="file" class="input_file" id="engfile' + cnt + '" name="engMainImg" /><label for="engfile' + cnt + '" class="btn_file">파일찾기</label><button type="button" class="btnDelete" data-key="" onclick="deleteFile(this); >첨부파일 삭제</button><p><label for="engurl' + cnt +'"><input type="text" name="mainImgEngLinks" id="url'+ cnt +'"placeholder="이미지에 대한 링크 URL"></label></p></div>';
					console.log("eng", cnt);
				}
				$(item).find(".file_area").append(html);
			};
		});
		//$fileArea.on("click" , ".btnDelete" ,deleteFile);
    });

    $('input[name=engYn]').change(function () {//영문 사이트 여부
        if ($('#engY').prop('checked')) {
            $('.eng_site').show();
        } else if ($('#engN').prop('checked')) {
            $('.eng_site').hide();
        }
    });

    $('input[name=productBannerYn]').change(function () {//상품 페이지 배너 배포 Y (국문)
        if ($('#productBannerY').prop('checked')) {
            $('.productTypeKor').prop('disabled', false);
        } else if ($('#productBannerN').prop('checked')) {
            $('.productTypeKor').prop('disabled', true);
        }
    });

    $('input[name=productBannerYnEng]').change(function () {//상품 페이지 배너 배포 Y (국문)
        if ($('#productBannerEngY').prop('checked')) {
            $('.productTypeEng').prop('disabled', false);
        } else if ($('#productBannerEngN').prop('checked')) {
            $('.productTypeEng').prop('disabled', true);
        }
    });

})(jQuery);
</script>
